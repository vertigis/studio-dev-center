"use strict";(globalThis.webpackChunkvertigis_studio_dev_center=globalThis.webpackChunkvertigis_studio_dev_center||[]).push([[3352],{3644:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>p,contentTitle:()=>u,default:()=>f,frontMatter:()=>d,metadata:()=>h,toc:()=>m});var t=i(7624),r=i(2172),s=i(964),a=i(7528),o=i(7160),c=i(1268),l=i(5388);const d={title:"Service Reference",description:"VertiGIS Studio Web - Service Reference"},u=void 0,h={id:"web/sdk-services-reference",title:"Service Reference",description:"VertiGIS Studio Web - Service Reference",source:"@site/docs/web/sdk-services-reference.mdx",sourceDirName:"web",slug:"/web/sdk-services-reference",permalink:"/docs/web/sdk-services-reference",draft:!1,unlisted:!1,editUrl:"https://github.com/vertigis/studio-dev-center/edit/master/docs/web/sdk-services-reference.mdx",tags:[],version:"current",frontMatter:{title:"Service Reference",description:"VertiGIS Studio Web - Service Reference"},sidebar:"web",previous:{title:"Create a Service",permalink:"/docs/web/sdk-services-create"},next:{title:"Service Injection",permalink:"/docs/web/sdk-services-injecting-services"}},p={},m=[{value:"Service Registration",id:"service-registration",level:2},{value:"Service Lifecycle",id:"service-lifecycle",level:2},{value:"Service Anatomy",id:"service-anatomy",level:2},{value:"Initialization and Cleanup",id:"initialization-and-cleanup",level:3},{value:"Message Bus",id:"message-bus",level:3},{value:"Models and Configuration",id:"models-and-configuration",level:2},{value:"Next Steps",id:"next-steps",level:2}];function v(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.M)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Services act as a repository of accessible behavior and data, and can be used for a variety of purposes, from implementing commands and operations, to managing shared data, to interfacing with the REST API of an external service."}),"\n",(0,t.jsx)(n.h2,{id:"service-registration",children:"Service Registration"}),"\n",(0,t.jsxs)(n.p,{children:["All services need to be registered with VertiGIS Studio Web. Services can optionally use the ",(0,t.jsx)(n.code,{children:"itemType"})," property to bind to an ",(0,t.jsx)(n.a,{href:"/docs/web/configuration-app-config-reference#app-items",children:"item in the app config"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'export default function(registry: LibraryRegistry) {\n    ...\n    registry.registerService({\n        id: "custom-service",\n        getService: (config) => new CustomService(config),\n        // Use this setting if you want your service to load an\n        // item from the app config.\n        itemType: "custom-service-model",\n        // Use this setting if you want your service to load on\n        // application startup. Defaults to `false`.\n        loadOnStartup: true,\n    })\n    ...\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"service-lifecycle",children:"Service Lifecycle"}),"\n",(0,t.jsxs)(n.p,{children:["On application load, all services that are configured to automatically load on startup are created and initialized ",(0,t.jsx)(n.strong,{children:"in parallel"}),", along with core services like the message bus."]}),"\n",(0,t.jsxs)(n.p,{children:["All other services are created and initialized (i.e. the ",(0,t.jsx)(n.code,{children:"_onInitialize"})," method is called) when they are first invoked. This can happen in multiple ways."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"If a command or operation implemented by the service is executed, then the service will be created and initialized to run that command."}),"\n",(0,t.jsx)(n.li,{children:"If a different component or service injects the service, then the service will be created and initialized to fulfill that dependency."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Services are destroyed (i.e. the ",(0,t.jsx)(n.code,{children:"_onDestroy"})," method is invoked) when the application is destroyed."]}),"\n",(0,t.jsx)(n.h2,{id:"service-anatomy",children:"Service Anatomy"}),"\n",(0,t.jsxs)(n.p,{children:["All services have access to initialization and cleanup methods, as well as the ",(0,t.jsx)(n.code,{children:"messages"})," property that allows for the registration and execution of commands and operations."]}),"\n",(0,t.jsx)(n.h3,{id:"initialization-and-cleanup",children:"Initialization and Cleanup"}),"\n",(0,t.jsxs)(n.p,{children:["Sometimes, a service is required to perform initialization and cleanup actions, for example, to initialize dynamic data and cleanup dangling references. The ",(0,t.jsx)(n.code,{children:"ServiceBase"})," class has two methods to achieve this:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"_onInitialize()"}),", which can be overridden with additional initialization logic,"]}),"\n",(0,t.jsxs)(n.li,{children:["and ",(0,t.jsx)(n.code,{children:"_onDestroy()"}),", which can be overridden to facilitate cleanup."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The following service uses these methods to subscribe to an event and cleanup the event handler afterwards."}),"\n",(0,t.jsx)(n.admonition,{title:"Important",type:"info",children:(0,t.jsxs)(n.p,{children:["Always call ",(0,t.jsx)(n.code,{children:"super._onInitialize()"})," before any custom initialization logic."]})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'import { ServiceBase } from "@vertigis/web/services";\nimport { MapEvent } from "@vertigis/viewer-spec/messaging/registry/map";\n\nexport default class CustomService extends ServiceBase {\n    handles: IHandle[] = [];\n\n    protected async _onInitialize(): Promise<void> {\n        await super._onInitialize();\n        this.handles.push(\n            this.messages.events.map.initialized.subscribe(\n                (e: MapEvent) => {\n                    console.log(\n                        "Map Initialized, do your map dependent model setup here."\n                    );\n                }\n            )\n        );\n    }\n\n    protected async _onDestroy(): Promise<void> {\n        await super._onDestroy();\n        this.handles.forEach((h) => h.remove());\n    }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"message-bus",children:"Message Bus"}),"\n",(0,t.jsxs)(n.p,{children:["All services have access to the ",(0,t.jsx)(n.code,{children:"messages"})," property on the class instance, which gives access to all ",(0,t.jsx)(n.a,{href:"/docs/web/sdk-commands-operations#running-commands-and-operations",children:"commands, operations, and events in the application"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"models-and-configuration",children:"Models and Configuration"}),"\n",(0,t.jsxs)(n.p,{children:["Like components, services can be configured through the ",(0,t.jsx)(n.a,{href:"/docs/web/configuration-app-config-getting-started",children:"app config"}),". A service can participate in the config by extending the ",(0,t.jsx)(n.code,{children:"ConfigurableServiceBase"})," class. For more information on the relationship between services and configuration, check out ",(0,t.jsx)(n.a,{href:"/docs/web/sdk-serializable-properties",children:"this article"}),". The following example demonstrates a service with one configurable property, ",(0,t.jsx)(n.code,{children:"name"}),"."]}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["The service is linked to the config through the ",(0,t.jsx)(n.code,{children:"itemType"})," and ",(0,t.jsx)(n.code,{children:"id"})," properties."]})}),"\n",(0,t.jsxs)(c.c,{defaultValue:"service",values:[{label:"Service",value:"service"},{label:"Registration",value:"registration"},{label:"App Config",value:"config"}],children:[(0,t.jsx)(l.c,{value:"service",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'export interface CustomServiceProperties\n    extends ServiceModelProperties {\n    name: string;\n}\n\n@serializable\nexport default class CustomServiceWithConfig extends ConfigurableServiceBase<CustomServiceProperties> {\n    // highlight-next-line\n    id: "my-unique-id";\n\n    name: string;\n\n    async sayHello(): Promise<string> {\n        return `Hello, ${this.name}`;\n    }\n\n    protected _getSerializableProperties(): PropertyDefs<CustomServiceProperties> {\n        return {\n            ...super._getSerializableProperties(),\n            name: {\n                serializeModes: ["initial"],\n                default: "Ian",\n            },\n        };\n    }\n}\n'})})}),(0,t.jsx)(l.c,{value:"registration",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'export default function (registry: LibraryRegistry) {\n    registry.registerService({\n        id: "custom-service",\n        title: "Custom Service",\n        getService: (config) => new CustomServiceWithConfig(config),\n        // highlight-next-line\n        itemType: "custom-service-model",\n    });\n}\n'})})}),(0,t.jsx)(l.c,{value:"config",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n    "schemaVersion": "1.0",\n    "items": [\n        {\n            "$type": "custom-service-model",\n            // highlight-next-line\n            "id": "my-unique-id",\n            "name": "Noah"\n        }\n    ]\n}\n'})})})]}),"\n",(0,t.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsxs)(o.c,{children:[(0,t.jsx)(a.c,{title:"Learn how to use Commands and Operations with Services",description:"Learn how to run and implement commands and operations with custom services",link:(0,s.c)("docs/web/sdk-commands-operations")}),(0,t.jsx)(a.c,{title:"Learn about Service Interactions",description:"Learn about how services can directly interact through dependency injection",link:(0,s.c)("docs/web/sdk-services-injecting-services")}),(0,t.jsx)(a.c,{title:"Build a Custom Command with a Custom Service",description:"Follow a step by step guide to building a custom command with a custom service",link:(0,s.c)("docs/web/tutorial-implement-command-operation")}),(0,t.jsx)(a.c,{title:"Build a Service that Manages Dynamic Data",description:"Built a service that manages a dynamic data source and exposes it to components",link:(0,s.c)("docs/web/tutorial-service-dynamic-data")})]})]})}function f(e={}){const{wrapper:n}={...(0,r.M)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(v,{...e})}):v(e)}},5388:(e,n,i)=>{i.d(n,{c:()=>a});i(1504);var t=i(4064);const r={tabItem:"tabItem_Ymn6"};var s=i(7624);function a({children:e,hidden:n,className:i}){return(0,s.jsx)("div",{role:"tabpanel",className:(0,t.c)(r.tabItem,i),hidden:n,children:e})}},1268:(e,n,i)=>{i.d(n,{c:()=>w});var t=i(1504),r=i(4064),s=i(3943),a=i(5592),o=i(5288),c=i(632),l=i(7128),d=i(1148);function u(e){return t.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:n,children:i}=e;return(0,t.useMemo)((()=>{const e=n??function(e){return u(e).map((({props:{value:e,label:n,attributes:i,default:t}})=>({value:e,label:n,attributes:i,default:t})))}(i);return function(e){const n=(0,l.w)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,i])}function p({value:e,tabValues:n}){return n.some((n=>n.value===e))}function m({queryString:e=!1,groupId:n}){const i=(0,a.Uz)(),r=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,c._M)(r),(0,t.useCallback)((e=>{if(!r)return;const n=new URLSearchParams(i.location.search);n.set(r,e),i.replace({...i.location,search:n.toString()})}),[r,i])]}function v(e){const{defaultValue:n,queryString:i=!1,groupId:r}=e,s=h(e),[a,c]=(0,t.useState)((()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!p({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const i=n.find((e=>e.default))??n[0];if(!i)throw new Error("Unexpected error: 0 tabValues");return i.value}({defaultValue:n,tabValues:s}))),[l,u]=m({queryString:i,groupId:r}),[v,f]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[i,r]=(0,d.IN)(n);return[i,(0,t.useCallback)((e=>{n&&r.set(e)}),[n,r])]}({groupId:r}),g=(()=>{const e=l??v;return p({value:e,tabValues:s})?e:null})();(0,o.c)((()=>{g&&c(g)}),[g]);return{selectedValue:a,selectValue:(0,t.useCallback)((e=>{if(!p({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);c(e),u(e),f(e)}),[u,f,s]),tabValues:s}}var f=i(3664);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var b=i(7624);function x({className:e,block:n,selectedValue:i,selectValue:t,tabValues:a}){const o=[],{blockElementScrollPositionUntilNextRender:c}=(0,s.MV)(),l=e=>{const n=e.currentTarget,r=o.indexOf(n),s=a[r].value;s!==i&&(c(n),t(s))},d=e=>{let n=null;switch(e.key){case"Enter":l(e);break;case"ArrowRight":{const i=o.indexOf(e.currentTarget)+1;n=o[i]??o[0];break}case"ArrowLeft":{const i=o.indexOf(e.currentTarget)-1;n=o[i]??o[o.length-1];break}}n?.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.c)("tabs",{"tabs--block":n},e),children:a.map((({value:e,label:n,attributes:t})=>(0,b.jsx)("li",{role:"tab",tabIndex:i===e?0:-1,"aria-selected":i===e,ref:e=>o.push(e),onKeyDown:d,onClick:l,...t,className:(0,r.c)("tabs__item",g.tabItem,t?.className,{"tabs__item--active":i===e}),children:n??e},e)))})}function y({lazy:e,children:n,selectedValue:i}){const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=r.find((e=>e.props.value===i));return e?(0,t.cloneElement)(e,{className:"margin-top--md"}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:r.map(((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==i})))})}function j(e){const n=v(e);return(0,b.jsxs)("div",{className:(0,r.c)("tabs-container",g.tabList),children:[(0,b.jsx)(x,{...e,...n}),(0,b.jsx)(y,{...e,...n})]})}function w(e){const n=(0,f.c)();return(0,b.jsx)(j,{...e,children:u(e.children)},String(n))}},7528:(e,n,i)=>{i.d(n,{c:()=>o});var t=i(867),r=(i(1504),i(4971));const s={root:"root_Uwqo"};var a=i(7624);function o({title:e,description:n,link:i}){return(0,a.jsx)("div",{className:(0,r.c)("card-demo",s.root),children:(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("div",{className:"card__header",children:(0,a.jsx)("h3",{children:e})}),(0,a.jsx)("div",{className:"card__body",children:(0,a.jsx)("p",{children:n})}),(0,a.jsx)("div",{className:"card__footer",children:(0,a.jsx)(t.c,{className:"button button--secondary button--block",to:i,children:"Get Started"})})]})})}},7160:(e,n,i)=>{i.d(n,{c:()=>s});i(1504);const t={root:"root_vxd5"};var r=i(7624);function s({children:e}){return(0,r.jsx)("div",{className:t.root,children:e})}},4971:(e,n,i)=>{function t(e){var n,i,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(n=0;n<e.length;n++)e[n]&&(i=t(e[n]))&&(r&&(r+=" "),r+=i);else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}i.d(n,{c:()=>r});const r=function(){for(var e,n,i=0,r="";i<arguments.length;)(e=arguments[i++])&&(n=t(e))&&(r&&(r+=" "),r+=n);return r}},2172:(e,n,i)=>{i.d(n,{I:()=>o,M:()=>a});var t=i(1504);const r={},s=t.createContext(r);function a(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);