"use strict";(globalThis.webpackChunkvertigis_studio_dev_center=globalThis.webpackChunkvertigis_studio_dev_center||[]).push([[8458],{6589:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>m,frontMatter:()=>r,metadata:()=>c,toc:()=>p});var s=t(4848),i=t(8453),o=t(1470),a=t(9365);const r={title:"Dependency Injection",description:"VertiGIS Studio Mobile - Learn about dependency injection in VertiGIS Studio Mobile"},l=void 0,c={id:"mobile/sdk-dependency-injection",title:"Dependency Injection",description:"VertiGIS Studio Mobile - Learn about dependency injection in VertiGIS Studio Mobile",source:"@site/docs/mobile/sdk-dependency-injection.mdx",sourceDirName:"mobile",slug:"/mobile/sdk-dependency-injection",permalink:"/docs/mobile/sdk-dependency-injection",draft:!1,unlisted:!1,editUrl:"https://github.com/vertigis/studio-dev-center/edit/master/docs/mobile/sdk-dependency-injection.mdx",tags:[],version:"current",frontMatter:{title:"Dependency Injection",description:"VertiGIS Studio Mobile - Learn about dependency injection in VertiGIS Studio Mobile"},sidebar:"mobile",previous:{title:"Events Reference",permalink:"/docs/mobile/sdk-events-reference"},next:{title:"Component and Service Interactions",permalink:"/docs/mobile/sdk-component-service-interactions"}},d={},p=[{value:"Components and Services",id:"components-and-services",level:2},{value:"List of Registration Assembly Attributes",id:"list-of-registration-assembly-attributes",level:2},{value:"<code>Export</code>",id:"export",level:3},{value:"<code>Component</code>",id:"component",level:3},{value:"<code>AppItemComponent</code>",id:"appitemcomponent",level:3},{value:"<code>Service</code>",id:"service",level:3},{value:"<code>AppItem</code>",id:"appitem",level:3},{value:"<code>View</code>",id:"view",level:3},{value:"<code>ViewModel</code>",id:"viewmodel",level:3},{value:"Managing Sub-Dependencies",id:"managing-sub-dependencies",level:2},{value:"Relevant SDK Sample",id:"relevant-sdk-sample",level:2}];function u(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:["If you are new to the concepts of ",(0,s.jsx)(n.strong,{children:"inversion of control"})," and ",(0,s.jsx)(n.strong,{children:"dependency injection"}),", check out ",(0,s.jsx)(n.a,{href:"https://martinfowler.com/articles/injection.html",children:"this article by Martin Fowler"}),"."]})}),"\n",(0,s.jsxs)(n.p,{children:["VertiGIS Studio Mobile relies heavily on inversion of control patterns to inject dependencies into its components and services. Under the hood, VertiGIS Studio Mobile uses ",(0,s.jsx)(n.a,{href:"https://autofaccn.readthedocs.io/en/latest/index.html",children:"Autofac"})," to register and inject components, services and other classes. To inject a dependency into a class in VertiGIS Studio Mobile, two things must happen."]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"The class to be injected must register itself with the autofac container."}),"\n",(0,s.jsx)(n.li,{children:"The class that requires the dependency must accept a concrete class or abstract interface in its constructor as a placeholder for the injected class."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["A good example of this pattern is the ",(0,s.jsx)(n.code,{children:"AlertOperations"})," class in the ",(0,s.jsx)(n.a,{href:"/docs/mobile/tutorial-implement-command-operation",children:"commands and operation"})," tutorial ."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cs",children:"using App1.Services.AlertOperations;\nusing VertiGIS.Mobile.Composition;\nusing VertiGIS.Mobile.Composition.Messaging;\nusing VertiGIS.Mobile.Infrastructure.Messaging;\n\n[assembly: Export(typeof(AlertOperations), SingleInstance = true)]\nnamespace App1.Services.AlertOperations\n{\n    class AlertOperations : OperationsBase\n    {\n        public AlertOperations(IOperationRegistry operationRegistry)\n            : base(operationRegistry)\n        {\n        }\n    }\n}\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"This class both registers itself as a dependency, and has dependencies injected itself."}),"\n",(0,s.jsxs)(n.li,{children:["The assembly attribute ",(0,s.jsx)(n.code,{children:"Export"})," is part of the VertiGIS Studio Mobile SDK, and registers the class with Autofac as a singleton."]}),"\n",(0,s.jsxs)(n.li,{children:["The constructor of the class takes an object of the type ",(0,s.jsx)(n.code,{children:"IOperationRegistry"}),". This dependency will be resolved by Autofac at runtime ",(0,s.jsx)(n.strong,{children:"when"})," ",(0,s.jsx)(n.code,{children:"AlertOperations"})," is injected by another class. Chaining dependency injection in this manner is both a common and best practice pattern in VertiGIS Studio Mobile."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["This is an example of a class that injects ",(0,s.jsx)(n.code,{children:"AlertOperations"}),", which will in turn inject an ",(0,s.jsx)(n.code,{children:"IOperationRegistry"})," into itself."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cs",children:"[assembly: Service(typeof(CustomService), PropertiesAutowired = true)]\nnamespace App1.Services\n{\n    class CustomService : ServiceBase\n    {\n        public CustomService(AlertOperations AlertOperations)\n            :base()\n        {\n            ...\n        }\n    }\n    ...\n}\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:["Autofac has a number of ways to inject dependencies, including factory functions which can dynamically spin up instances of a class or lazy wrappers for dependencies. For details, check out ",(0,s.jsx)(n.a,{href:"https://autofaccn.readthedocs.io/en/latest/resolve/relationships.html",children:"the Autofac documentation."})]})}),"\n",(0,s.jsx)(n.h2,{id:"components-and-services",children:"Components and Services"}),"\n",(0,s.jsxs)(n.p,{children:["Components and services in VertiGIS Studio Mobile are almost always initialized by Autofac. This means that they can inject any class that has been registered with Autofac in their constructor, allowing classes used for behavior like ",(0,s.jsx)(n.a,{href:"/docs/mobile/configuration-commands-operations",children:"commands and operations"})," to be easily shared and loosely coupled to many components and services. Root level components (components that are instantiated from a layout definition) must ",(0,s.jsx)(n.strong,{children:"always"})," register with Autofac to be correctly initialized, and it is best practice to use dependency injection to initialize instances of any other custom classes, services or components that the root level component depends on."]}),"\n",(0,s.jsx)(n.h2,{id:"list-of-registration-assembly-attributes",children:"List of Registration Assembly Attributes"}),"\n",(0,s.jsx)(n.p,{children:"There's a number of different VertiGIS Studio Mobile specific assembly attributes which allow classes to register themselves with VertiGIS Studio Mobile's Autofac container."}),"\n",(0,s.jsx)(n.h3,{id:"export",children:(0,s.jsx)(n.code,{children:"Export"})}),"\n",(0,s.jsx)(n.p,{children:"Used for registering a generic class with Autofac."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cs",children:"[assembly: Export(typeof(MyCustomClass))]\n"})}),"\n",(0,s.jsx)(n.h3,{id:"component",children:(0,s.jsx)(n.code,{children:"Component"})}),"\n",(0,s.jsxs)(n.p,{children:["Used for registering a component that ",(0,s.jsx)(n.strong,{children:"does not"})," consume configuration. For a more detailed example, see the tutorial on ",(0,s.jsx)(n.a,{href:"/docs/mobile/tutorial-implement-component-with-ui#create-a-component-skeleton",children:"implementing a custom component"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cs",children:'[assembly: Component(typeof(MyCustomComponent), "my-custom-component")]\n'})}),"\n",(0,s.jsx)(n.h3,{id:"appitemcomponent",children:(0,s.jsx)(n.code,{children:"AppItemComponent"})}),"\n",(0,s.jsxs)(n.p,{children:["Used for registering a component that ",(0,s.jsx)(n.strong,{children:"does"})," consume configuration. For a more detailed example, see the tutorial on ",(0,s.jsx)(n.a,{href:"/docs/mobile/tutorial-implement-component-participate-app-config#consume-the-configuration-in-the-component",children:"implementing a custom component with configuration"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cs",children:'[assembly: AppItemComponent(typeof(MyCustomComponent), "my-custom-component", MyCustomComponentConfiguration.ConfigItemtype)]\n'})}),"\n",(0,s.jsx)(n.h3,{id:"service",children:(0,s.jsx)(n.code,{children:"Service"})}),"\n",(0,s.jsxs)(n.p,{children:["Used for registering a service. For a more detailed example, see ",(0,s.jsx)(n.a,{href:"/docs/mobile/sdk-services-create",children:"create a service"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cs",children:"[assembly: Service(typeof(CustomService))]\n"})}),"\n",(0,s.jsx)(n.h3,{id:"appitem",children:(0,s.jsx)(n.code,{children:"AppItem"})}),"\n",(0,s.jsxs)(n.p,{children:["Used for registering the definition for an ",(0,s.jsx)(n.a,{href:"/docs/mobile/configuration-app-config-reference#app-items",children:"app item"})," with VertiGIS Studio Mobile. For a more detailed example, see the tutorial on ",(0,s.jsx)(n.a,{href:"/docs/mobile/tutorial-implement-component-participate-app-config#create-a-skeleton-app-config-definition",children:"implementing a custom component with app configuration"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cs",children:"[assembly: AppItem(CustomAppItem.AppItemType, typeof(CustomAppItem))]\n"})}),"\n",(0,s.jsx)(n.h3,{id:"view",children:(0,s.jsx)(n.code,{children:"View"})}),"\n",(0,s.jsxs)(n.p,{children:["Used for registering a ",(0,s.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/xamarin/xamarin-forms/enterprise-application-patterns/mvvm",children:"view"})," with VertiGIS Studio Mobile. For a more detailed example see the tutorial on ",(0,s.jsx)(n.a,{href:"/docs/mobile/tutorial-implement-component-with-ui#use-xaml-to-define-your-ui",children:"implementing a custom component with UI"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cs",children:"[assembly: View(typeof(CustomView))]\n"})}),"\n",(0,s.jsx)(n.h3,{id:"viewmodel",children:(0,s.jsx)(n.code,{children:"ViewModel"})}),"\n",(0,s.jsxs)(n.p,{children:["Used for registering a ",(0,s.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/xamarin/xamarin-forms/enterprise-application-patterns/mvvm",children:"view model"})," with VertiGIS Studio Mobile. For a more detailed example see the tutorial on ",(0,s.jsx)(n.a,{href:"/docs/mobile/tutorial-implement-component-with-ui#example-progress-bar",children:"implementing a custom component with UI"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cs",children:"[assembly: ViewModel(typeof(CustomViewModel))]\n"})}),"\n",(0,s.jsx)(n.h2,{id:"managing-sub-dependencies",children:"Managing Sub-Dependencies"}),"\n",(0,s.jsx)(n.p,{children:"Sometimes, you may may want to split code associated with a component or service into multiple classes for individual views, utility functions, etc. Each of these classes may have dependencies on global classes registered with Autofac, such as operations, but only the registered component is instantiated by dependency injection, so only the component class can inject these global classes. One solution is to have the component class inject all the dependencies of its associated classes and pass them to the class constructors, but this pattern introduces unnecessary boilerplate and coupling. Instead, if the component class creates instances of associated classes through dependency injection, then Autofac will automatically resolve any dependencies the associated class has."}),"\n",(0,s.jsxs)(n.p,{children:["In the example below, the ",(0,s.jsx)(n.code,{children:"RelatedClass"})," has a global dependency, ",(0,s.jsx)(n.code,{children:"MapOperations"}),". In order to resolve this dependency, the ",(0,s.jsx)(n.code,{children:"CustomComponent"})," creates an instance of the ",(0,s.jsx)(n.code,{children:"RelatedClass"})," through dependency injection."]}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:["Autofac allows for the injection of ",(0,s.jsx)(n.a,{href:"https://autofaccn.readthedocs.io/en/latest/resolve/relationships.html#supported-relationship-types",children:"factory functions for classes, partially resolved class constructors, and more"}),"."]})}),"\n",(0,s.jsxs)(o.A,{defaultValue:"related",values:[{label:"Related Class",value:"related"},{label:"Component",value:"component"}],children:[(0,s.jsx)(a.A,{value:"related",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cs",children:"using VertiGIS.Mobile.Composition;\nusing VertiGIS.Mobile.Infrastructure.Messaging;\nusing VertiGIS.Mobile.Samples.Samples.Custom.Component;\n\n// highlight-next-line\n[assembly: Export(typeof(RelatedClass))]\nnamespace VertiGIS.Mobile.Samples.Samples.Custom.Component\n{\n    internal class RelatedClass\n    {\n        private MapOperations _mapOperations;\n\n        // highlight-next-line\n        public RelatedClass(MapOperations mapOperations)\n        {\n            _mapOperations = mapOperations;\n        }\n    }\n}\n"})})}),(0,s.jsx)(a.A,{value:"component",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cs",children:'using VertiGIS.Mobile.Samples;\nusing VertiGIS.Mobile.Samples.Samples.Custom.Component;\nusing VertiGIS.Mobile.Composition.Layout;\nusing System.Xml.Linq;\nusing Xamarin.Forms;\n\n[assembly: Component(typeof(CustomComponent), "component", XmlNamespace = XmlNamespaces.SamplesNamespace)]\nnamespace VertiGIS.Mobile.Samples.Samples.Custom.Component\n{\n    internal class CustomComponent : ComponentBase\n    {\n        private RelatedClass _relatedClass;\n\n        // highlight-next-line\n        public CustomComponent(RelatedClass relatedClass)\n        {\n            _relatedClass = relatedClass;\n        }\n\n        protected override VisualElement Create(XNode node)\n        {\n            return new Label()\n            {\n                Text = "Hello, World!",\n                HorizontalTextAlignment = TextAlignment.Center\n            };\n        }\n    }\n}\n'})})})]}),"\n",(0,s.jsx)(n.h2,{id:"relevant-sdk-sample",children:"Relevant SDK Sample"}),"\n",(0,s.jsxs)(n.p,{children:["Check out the VertiGIS Studio Mobile SDK Sample for ",(0,s.jsx)(n.a,{href:"https://github.com/vertigis/vertigis-mobile-samples/tree/master/Geocortex.Mobile.Samples/Geocortex.Mobile.Samples/Samples/Conceptual/DependencyInjection",children:"dependency injection"}),"."]})]})}function m(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},9365:(e,n,t)=>{t.d(n,{A:()=>a});t(6540);var s=t(8215);const i={tabItem:"tabItem_Ymn6"};var o=t(4848);function a({children:e,hidden:n,className:t}){return(0,o.jsx)("div",{role:"tabpanel",className:(0,s.A)(i.tabItem,t),hidden:n,children:e})}},1470:(e,n,t)=>{t.d(n,{A:()=>S});var s=t(6540),i=t(8215),o=t(3104),a=t(6347),r=t(205),l=t(7485),c=t(1682),d=t(9466);function p(e){return s.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:n,children:t}=e;return(0,s.useMemo)((()=>{const e=n??function(e){return p(e).map((({props:{value:e,label:n,attributes:t,default:s}})=>({value:e,label:n,attributes:t,default:s})))}(t);return function(e){const n=(0,c.X)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function m({value:e,tabValues:n}){return n.some((n=>n.value===e))}function h({queryString:e=!1,groupId:n}){const t=(0,a.W6)(),i=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,l.aZ)(i),(0,s.useCallback)((e=>{if(!i)return;const n=new URLSearchParams(t.location.search);n.set(i,e),t.replace({...t.location,search:n.toString()})}),[i,t])]}function f(e){const{defaultValue:n,queryString:t=!1,groupId:i}=e,o=u(e),[a,l]=(0,s.useState)((()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find((e=>e.default))??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:o}))),[c,p]=h({queryString:t,groupId:i}),[f,b]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,i]=(0,d.Dv)(n);return[t,(0,s.useCallback)((e=>{n&&i.set(e)}),[n,i])]}({groupId:i}),g=(()=>{const e=c??f;return m({value:e,tabValues:o})?e:null})();(0,r.A)((()=>{g&&l(g)}),[g]);return{selectedValue:a,selectValue:(0,s.useCallback)((e=>{if(!m({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);l(e),p(e),b(e)}),[p,b,o]),tabValues:o}}var b=t(2303);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var x=t(4848);function j({className:e,block:n,selectedValue:t,selectValue:s,tabValues:a}){const r=[],{blockElementScrollPositionUntilNextRender:l}=(0,o.a_)(),c=e=>{const n=e.currentTarget,i=r.indexOf(n),o=a[i].value;o!==t&&(l(n),s(o))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const t=r.indexOf(e.currentTarget)+1;n=r[t]??r[0];break}case"ArrowLeft":{const t=r.indexOf(e.currentTarget)-1;n=r[t]??r[r.length-1];break}}n?.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":n},e),children:a.map((({value:e,label:n,attributes:s})=>(0,x.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>r.push(e),onKeyDown:d,onClick:c,...s,className:(0,i.A)("tabs__item",g.tabItem,s?.className,{"tabs__item--active":t===e}),children:n??e},e)))})}function v({lazy:e,children:n,selectedValue:t}){const i=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=i.find((e=>e.props.value===t));return e?(0,s.cloneElement)(e,{className:"margin-top--md"}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:i.map(((e,n)=>(0,s.cloneElement)(e,{key:n,hidden:e.props.value!==t})))})}function y(e){const n=f(e);return(0,x.jsxs)("div",{className:(0,i.A)("tabs-container",g.tabList),children:[(0,x.jsx)(j,{...e,...n}),(0,x.jsx)(v,{...e,...n})]})}function S(e){const n=(0,b.A)();return(0,x.jsx)(y,{...e,children:p(e.children)},String(n))}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>r});var s=t(6540);const i={},o=s.createContext(i);function a(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);